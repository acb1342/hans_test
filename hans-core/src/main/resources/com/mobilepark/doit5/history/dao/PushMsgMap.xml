<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="pushMsg">

    <select id="selectUserMessageList" parameterType="map" resultType="map">
        SELECT /* pushMsg.selectUserMessageList */
        	  MSG as msg
        	, FST_RG_DT as fstRgDt
        FROM TB_HIST_PUSH_MSG
        WHERE USID = #{usid}
        ORDER BY FST_RG_DT DESC
        LIMIT #{pagination.startRow}, #{pagination.size}
    </select>
    
    
    <select id="selectUserMessageTotalCnt" parameterType="map" resultType="int">
        SELECT /* pushMsg.selectUserMessageTotalCnt */
        	  COUNT(*) as cnt
        FROM TB_HIST_PUSH_MSG
        WHERE USID = #{usid}
    </select>
    
    <select id="selectPushQueueList" parameterType="int" resultType="map">
        SELECT /* pushMsg.selectPushQueueList */
			  SN_ID as snId
			, CUST_TYPE as custType
			, USID as usid
			, CUST_NAME as custName
			, OS as os
			, MOBILE as mobile
			, CATEGORY as category
			, TITLE as title
			, MSG as msg
			, PUSH_TOKEN as pushToken
			, FST_RG_USID as fstRgUsid
			, FST_RG_DT as fstRgDt
			, LST_CH_USID as lstChUsid
			, LST_CH_DT as lstChDt
        FROM TB_LINK_PUSH_QUEUE
        ORDER BY FST_RG_DT
        LIMIT 0, #{limit}
    </select>
    
    <delete id="deletePushQueue" parameterType="java.math.BigInteger">
    	DELETE /* pushMsg.deletePushQueue */
    	FROM TB_LINK_PUSH_QUEUE
    	WHERE SN_ID = #{snId}
    </delete>
    
    <insert id="insertPushMessage" parameterType="map">
    	INSERT /* pushMsg.insertPushMessage */
    	INTO TB_HIST_PUSH_MSG (
    		  FST_RG_DT
			, CUST_TYPE
			, USID
			, CUST_NAME
			, OS
			, MOBILE
			, CATEGORY
			, TITLE
			, MSG
			, RESULT_CODE
			, FST_RG_USID
			, LST_CH_USID
    	) VALUES (
    		  NOW()
    		, #{custType}
    		, #{usid}
    		, #{custName}
    		, #{os}
    		, #{mobile}
    		, #{category}
    		, #{title}
    		, #{msg}
    		, #{resultCode}
    		, #{usid}
    		, #{usid}
    	)
    </insert>
    
    <insert id="insertPushQueue" parameterType="map">
    	INSERT /* pushMsg.insertPushQueue */
    	INTO TB_LINK_PUSH_QUEUE (
    		  CUST_TYPE
    		, USID
    		, CUST_NAME
    		, OS
    		, MOBILE
    		, CATEGORY
    		, TITLE
    		, MSG
    		, PUSH_TOKEN
    		, FST_RG_USID
    		, LST_CH_USID
    	) VALUES (
    		  #{custType}
    		, #{usid}
    		, #{custName}
    		, #{os}
    		, #{mobile}
    		, #{category}
    		, #{title}
    		, #{msg}
    		, #{pushToken}
    		, #{usid}
    		, #{usid}
    	)
    </insert>
    
</mapper>