<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mobilepark.doit5.admin.dao.CodeDaoMybatis">
	
	<select id="getAdmin" parameterType="String" resultType="com.mobilepark.doit5.admin.model.Admin">
      SELECT  ADMIN_ID AS id
      			, ADMIN_GROUP_ID AS groupId
      			, PASSWD AS passwd
      			, NAME AS name
      			, GRADE AS grade
      			, AREA AS area
      			, MOBILE AS mobile
      			, TEL AS tel
      			, EMAIL AS email
      			, PUSH_TOKEN AS pushToken
      			, VALID_YN AS validYn
      			, PW_ERR_CNT AS pwErrCnt
      			, FST_RG_USID AS fstRgUsid
      			, FST_RG_DT AS fstRgDt
      			, LST_CH_USID AS lstChUsid
      			, LST_CH_DT AS lstChDt
      	FROM TB_MGMT_ADMIN
		<where>
			1 = 1
			<if test="userId != null">
				AND ADMIN_ID = #{userId}
			</if>
		</where>
	</select>
	
	<select id="getAdminGroup" parameterType="int" resultType="com.mobilepark.doit5.admin.model.AdminGroup">
		SELECT ADMIN_GROUP_ID AS id
				, NAME AS name
				, DESCRIPTION AS description
				, FST_RG_USID AS fstRgUsid
				, FST_RG_DT AS fstRgDt
      			, LST_CH_USID AS lstChUsid
      			, LST_CH_DT AS lstChDt
		FROM TB_MGMT_ADMIN_GROUP
		<where>
			1 = 1
			<if test="groupId != null">
				AND ADMIN_GROUP_ID = #{groupId}
			</if>
		</where>
	</select>
	
	<select id="searchGroupAuth" parameterType="int" resultType="com.mobilepark.doit5.admin.model.AdminGroupAuth">
		SELECT ADMIN_GROUP_ID AS adminGroupId
				, MENU_ID AS menuId
				, AUTH AS auth
				, FST_RG_USID AS fstRgUsid
				, FST_RG_DT AS fstRgDt
      			, LST_CH_USID AS lstChUsid
      			, LST_CH_DT AS lstChDt
		FROM TB_MGMT_ADMIN_GROUPAUTH
		<where>
			1 = 1
			<if test="groupId != null">
				AND ADMIN_GROUP_ID = #{groupId}
			</if>
		</where>
	</select>
	
	<insert id="createSession" parameterType="Map">
		INSERT INTO TB_MGMT_ADMIN_SESSION (ADMIN_ID, LEVEL, SESSION_ID, HOST, PORT, CHAN, FST_RG_USID, FST_RG_DT)
		VALUES (#{param.adminId}, #{param.level}, #{param.sessionId}, #{param.host}, #{param.port}, #{param.chan}, #{param.fstRgUsid}, #{param.fstRgDt})
	</insert>
	
	<delete id="deleteSession" parameterType="int">
		DELETE FROM TB_MGMT_ADMIN_SESSION
		<where>
			<if test="snId != null and snId > 0">
				SN_ID = #{snId}
			</if>
		</where>
	</delete>
	
	<select id="searchSession" parameterType="Map" resultType="Map">
		SELECT SN_ID AS id
				, ADMIN_ID AS adminId
				, SESSION_ID AS sessionId
				, LEVEL AS level
				, CHAN AS chan
				, HOST AS host
				, PORT AS port
				, FLAG AS flag
				, EDT AS edt
				, FST_RG_USID AS fstRgUsid
				, FST_RG_DT AS fstRgDt
				, LST_CH_USID AS lstChUsid
				, LST_CH_DT AS lstChDt
		FROM TB_MGMT_ADMIN_SESSION
		<where>
			1 = 1
			<if test="param.adminId != null">
				AND ADMIN_ID = #{param.adminId}
			</if>
			<if test="param.chan != null">
				AND CHAN = #{param.chan}
			</if>
			<if test="param.sessionId != null">
				AND SESSION_ID = #{param.sessionId}
			</if>
		</where>
	</select>
	
	<delete id="clearSessionAll" parameterType="String">
		DELETE FROM TB_MGMT_ADMIN_SESSION
		<where>
			<if test="chan != null">
				CHAN = #{chan}
			</if>
		</where>
	</delete>
	
	
	<!-- 신규 -->
	
	
	<select id="getCount" parameterType="java.util.Map" resultType="int">
	  SELECT  COUNT(*)
      	FROM TB_MGMT_CODE
      	<where>
      		<if test="param.searchType != null">
	      		<choose>
	                <when test="param.searchType == 'id' ">
	                    AND CODE like  CONCAT('%',#{param.searchValue},'%')
	                </when>
	                <otherwise>
	                    AND CODE_NAME like  CONCAT('%',#{param.searchValue},'%')
	                </otherwise>
            	</choose>
			</if>
		</where>
	</select>
	
	
	<select id="getCodeList" parameterType="java.util.Map" resultType="java.util.Map">
	  SELECT CODE AS code
      			, PARENTS_CODE AS parentsCode
      			, CODE_NAME AS codeName
      			, CODE_DESCRIPT AS codeDesc
      	FROM TB_MGMT_CODE
      	<where>
      		<if test="param.searchType != null">
	      		<choose>
	                <when test="param.searchType == 'id' ">
	                    AND CODE like  CONCAT('%',#{param.searchValue},'%')
	                </when>
	                <otherwise>
	                    AND CODE_NAME like  CONCAT('%',#{param.searchValue},'%')
	                </otherwise>
            	</choose>
			</if>
		</where>
		LIMIT #{param.startRow}, #{param.PerPage}	
	</select>
	
	<select id="getCodeDetail" parameterType="String" resultType="java.util.Map">
	  SELECT   CODE AS code
      			, PARENTS_CODE AS parentsCode
      			, CODE_NAME AS codeName
      			, CODE_DESCRIPT AS codeDesc
      			, REG_DATE as regDate
      	FROM TB_MGMT_CODE
      	<where>
      		CODE = #{id}
		</where>
	</select>
	
	
	<update id="CodeUpdate" parameterType="java.util.Map">
	  update TB_MGMT_CODE set
	    CODE_NAME = #{param.codeName},
	    CODE_DESCRIPT = #{param.codeDesc},
	    UPDATE_DATE = #{param.updateDate}
	  where CODE = #{param.id}
	</update>
	
	
	
	<insert id="CodeCreate" parameterType="java.util.Map">
	  insert into TB_MGMT_CODE (CODE, PARENTS_CODE, CODE_NAME, CODE_DESCRIPT, REG_DATE)
	  values (#{param.id},#{param.parentsCode},#{param.codeName},#{param.codeDesc},#{param.regDate})
	</insert>
	
	<delete id="CodeDelete" parameterType="String">
	  delete from TB_MGMT_CODE where CODE = #{id}
	</delete>
	
	
</mapper>