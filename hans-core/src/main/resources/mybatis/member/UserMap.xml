<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mobilepark.doit5.member.dao.UserDaoMybatis">
	<select id="count" parameterType="Map" resultType="int">
		SELECT
		COUNT(*)
		FROM
		TBL_USER_INFO U, TBL_COMPANY_INFO P
		WHERE
		1=1 AND U.COMPANY_SEQ = P.COMPANY_SEQ
		<if test="param.searchType != null">
			<choose>
				<when test="param.searchType == 'all'">
					AND U.USER_NAME LIKE CONCAT ('%', #{param.searchValue}, '%')
					OR U.BIRTHDAY LIKE CONCAT ('%', #{param.searchValue}, '%')
					OR P.COMPANY_NAME LIKE CONCAT ('%', #{param.searchValue}, '%')
				</when>
				<when test="param.searchType == 'user_name'">
					AND U.USER_NAME LIKE CONCAT ('%', #{param.searchValue}, '%')
				</when>
				<when test="param.searchType == 'birthday'">
					AND U.BIRTHDAY LIKE CONCAT ('%', #{param.searchValue}, '%')
				</when>
				<when test="param.searchType == 'company_name'">
					AND P.COMPANY_NAME LIKE CONCAT ('%', #{param.searchValue}, '%')
				</when>
			</choose>
		</if>
	</select>

	<select id="search" parameterType="Map" resultType="Map">
		SELECT
		U.USER_SEQ AS id,
		U.USER_SEQ AS user_seq,
		U.COMPANY_SEQ AS company_seq,
		P.COMPANY_NAME AS company_name,
		U.BIRTHDAY as birthday,
		U.USE_YN as use_yn,
		U.USER_NAME as user_name,
		U.LOCATION AS location,
		U.RSSI_VOLUME AS rssi_volume,
		U.USER_IP AS user_ip,
		U.USER_MODE AS user_mode,
		U.REG_DATE AS reg_date,
		U.MOD_DATE AS mod_date
		FROM
		TBL_USER_INFO U. TBL_COMPANY_INFO P
		WHERE
		1=1 U.COMPANY_SEQ = P.COMPANY_SEQ
		<if test="param.searchType != null">
			<choose>
				<when test="param.searchType == 'all'">
					AND U.USER_NAME LIKE CONCAT ('%', #{param.searchValue}, '%')
					OR U.BIRTHDAY LIKE CONCAT ('%', #{param.searchValue}, '%')
					OR P.COMPANY_NAME LIKE CONCAT ('%', #{param.searchValue}, '%')
				</when>
				<when test="param.searchType == 'user_name'">
					AND U.USER_NAME LIKE CONCAT ('%', #{param.searchValue}, '%')
				</when>
				<when test="param.searchType == 'birthday'">
					AND U.BIRTHDAY LIKE CONCAT ('%', #{param.searchValue}, '%')
				</when>
				<when test="param.searchType == 'company_name'">
					AND P.COMPANY_NAME LIKE CONCAT ('%', #{param.searchValue}, '%')
				</when>
			</choose>
		</if>
		ORDER BY U.USER_SEQ DESC
		LIMIT #{param.startRow}, #{param.rowPerPage}
	</select>

	<select id="get" parameterType="Long" resultType="com.mobilepark.doit5.member.model.User">
		SELECT
		USER_SEQ AS id,
		USER_SEQ AS user_seq,
		COMPANY_SEQ AS company_seq,
		BIRTHDAY as birthday,
		USE_YN as use_yn,
		USER_NAME as user_name,
		LOCATION AS location,
		RSSI_VOLUME AS rssi_volume,
		USER_IP AS user_ip,
		USER_MODE AS user_mode,
		REG_DATE AS reg_date,
		MOD_DATE AS mod_date
		FROM
		TBL_USER_INFO
		WHERE
		USER_SEQ = #{id}
	</select>

	<insert id="create" parameterType="com.mobilepark.doit5.member.model.User">
		INSERT INTO TBL_USER_INFO
		(
		COMPANY_SEQ
		<if test="user.user_name != null">, USER_NAME </if>
		<if test="user.birthday != null">, BIRTHDAY </if>
		<if test="user.use_yn != null">, USE_YN </if>
		<if test="user.location != null">, LOCATION </if>
		<if test="user.rssi_volume != null">, RSSI_VOLUME </if>
		<if test="user.user_ip != null">, USER_IP </if>
		<if test="user.user_mode != null">, USER_MODE </if>
		,REG_DATE
		)
		VALUES
		(
		#{user.company_seq}
		<if test="user.user_name != null">, #{user.user_name} </if>
		<if test="user.birthday != null">, #{user.birthday} </if>
		<if test="user.use_yn != null">, #{user.use_yn} </if>
		<if test="user.location != null">, #{user.location} </if>
		<if test="user.rssi_volume != null">, #{user.rssi_volume} </if>
		<if test="user.user_ip != null">, #{user.user_ip} </if>
		<if test="user.user_mode != null">, #{user.user_mode} </if>
		,NOW()
		)
	</insert>

	<update id="update" parameterType="Map">
		UPDATE
		TBL_USER_INFO
		SET
		COMPANY_SEQ = #{user.company_seq}
		<if test="user.user_name != null">, USER_NAME = #{user.user_name}</if>
		<if test="user.birthday != null">, BIRTHDAY = #{user.birthday}</if>
		<if test="user.use_yn != null">, USE_YN = #{user.use_yn}</if>
		<if test="user.location != null">, LOCATION = #{user.location}</if>
		<if test="user.rssi_volume != null">, RSSI_VOLUME = #{user.rssi_volume}</if>
		<if test="user.user_ip != null">, USER_IP = #{user.user_ip}</if>
		<if test="user.user_mode != null">, USER_MODE = #{user.user_mode}</if>
		,MOD_DATE = NOW()
		WHERE
		USER_SEQ = #{user.user_seq}
	</update>


	<delete id="delete" parameterType="Long">
		DELETE FROM TBL_USER_INFO WHERE USER_SEQ = #{id}
	</delete>
</mapper>